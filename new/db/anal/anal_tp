NAME=Backward param type propgation
FILE=../bins/anal/back1
CMDS=<<EXPECT
aa
s main
aaft
afv
EXPECT=<<RUN
var size_t size @ rbp-0x14
var char * dest @ rbp-0x10
var char * src @ rbp-0x8
RUN

NAME=Forward param type propgation
FILE=../bins/anal/forward1
CMDS=<<EXPECT
aa
s main
aaft
afv
EXPECT=<<RUN
var size_t size @ rbp-0x14
var char * ptr @ rbp-0x10
var char * src @ rbp-0x8
RUN

NAME=Propgation via value
FILE=../bins/anal/follow_ptr
CMDS=<<EXPECT
aa
s main
aaft
afv
EXPECT=<<RUN
var size_t var_1ch @ rbp-0x1c
var char * var_18h @ rbp-0x18
var char * s @ rbp-0x10
var char * var_8h @ rbp-0x8
RUN

NAME=General type propgation
FILE=../bins/anal/hello_world
CMDS=<<EXPECT
aa
s main
aaft
afv
EXPECT=<<RUN
var size_t var_20h @ rbp-0x20
var size_t size @ rbp-0x1c
var char * src @ rbp-0x18
var char * s2 @ rbp-0x10
var char * dest @ rbp-0x8
RUN

NAME=32-bit bin type propgation
FILE=../bins/anal/hello_world32
CMDS=<<EXPECT
aa
s main
aaft
afv
EXPECT=<<RUN
arg int arg_4h @ esp+0x4
var char * src @ ebp-0x1c
var char * s2 @ ebp-0x18
var size_t var_14h @ ebp-0x14
var size_t size @ ebp-0x10
var char * dest @ ebp-0xc
var int var_8h @ ebp-0x8
RUN

NAME=Register based var
FILE=../bins/anal/arg
CMDS=<<EXPECT
aa
s sym.funcarg
afvr
EXPECT=<<RUN
arg int arg1 @ rdi
arg int arg2 @ rsi
arg int arg3 @ rdx
arg int arg4 @ rcx
RUN

NAME=Type propgation for reg based arg
FILE=../bins/anal/arg
CMDS=<<EXPECT
aa
aaft
s sym.funcarg
afvr
EXPECT=<<RUN
arg char * arg1 @ rdi
arg char * arg2 @ rsi
arg int arg3 @ rdx
arg size_t arg4 @ rcx
RUN

NAME=Caller to callee propgation (64 bits)
FILE=../bins/anal/arg_down_prop
CMDS=<<EXPECT
e asm.lines = false
e asm.xrefs = false
aa
aaft
s sym.funcarg
pd 1
EXPECT=<<RUN
(fcn) sym.funcarg 154
  sym.funcarg (char *arg1, uint32_t arg2);
; var uint32_t var_ch @ rbp-0xc
; var char *var_8h @ rbp-0x8
; arg char *arg1 @ rdi
; arg uint32_t arg2 @ rsi
0x0000068a      55             push rbp
RUN

NAME=Caller to caller propgation (32 bits)
FILE=../bins/anal/arg_down_32
CMDS=<<EXPECT
e asm.lines = false
e asm.xrefs = false
aa
aaft
s sym.funcarg
pd 1
EXPECT=<<RUN
(fcn) sym.funcarg 147
  sym.funcarg (char *arg_8h, uint32_t arg_ch);
; var int var_4h @ ebp-0x4
; arg char *arg_8h @ ebp+0x8
; arg uint32_t arg_ch @ ebp+0xc
0x0000054d      55             push ebp
RUN

NAME=Type Propagation
FILE=../bins/pe/debugme.exe
BROKEN=1
CMDS=<<EXPECT
aaaa
pd 1 @ 0x00401792~?[n
pd 1 @ 0x00401796~?[c
pd 1 @ 0x0040179e~?[s
pd 1 @ 0x004017b1~?[n
pd 1 @ 0x004017b5~?[c
pd 1 @ 0x004017bd~?[s
pd 1 @ 0x0040186a~?[s2
pd 1 @ 0x0040186e~?[s1
pd 1 @ 0x0040152f~?[dwInitParam
pd 1 @ 0x00401537~?[lpDialogFunc
pd 1 @ 0x0040153f~?[hWndParent
pd 1 @ 0x00401547~?[lpTemplateName
pd 1 @ 0x00401554~?[hInstance
EXPECT=<<RUN
1
1
1
1
1
1
1
1
1
1
1
1
1
RUN

NAME=Double pointer test
FILE=../bins/anal/double_ptr
CMDS=<<EXPECT
aa
aaft
s main
afv~ptr
EXPECT=<<RUN
var char ** ptr @ rbp-0x18
RUN

NAME=Signed and unsigned test
FILE=../bins/anal/signed_test
CMDS=<<EXPECT
aa
aaft
s main
afv~sign
EXPECT=<<RUN
var signed int var_34h @ rbp-0x34
var signed int var_30h @ rbp-0x30
var uint32_t var_28h @ rbp-0x28
RUN

NAME=flagspace analysis
FILE=../bins/anal/flagspace
CMDS=<<EXPECT
aa
aaft
s main
afv
EXPECT=<<RUN
var int var_34h @ rbp-0x34
var signed int var_30h @ rbp-0x30
var uint32_t var_2ch @ rbp-0x2c
var FILE * stream @ rbp-0x28
var char * s @ rbp-0x20
var char * var_18h @ rbp-0x18
var char * var_10h @ rbp-0x10
var int canary @ rbp-0x8
RUN

NAME=bashbot test (x86_64)
FILE=../bins/anal/bashbot.x86_64.O0.elf
CMDS=<<EXPECT
aa
aaft
s main
afv
s sym.processCmd
afv
EXPECT=<<RUN
var char ** var_14e0h @ rbp-0x14e0
var int var_14d4h @ rbp-0x14d4
var int wstatus @ rbp-0x14cc
var int options @ rbp-0x14c8
var int var_14c4h @ rbp-0x14c4
var signed int var_14c0h @ rbp-0x14c0
var int var_14bch @ rbp-0x14bc
var pid_t pid @ rbp-0x14b8
var uint32_t var_14b4h @ rbp-0x14b4
var uint32_t var_14b0h @ rbp-0x14b0
var int var_14ach @ rbp-0x14ac
var char * var_14a8h @ rbp-0x14a8
var char * s @ rbp-0x14a0
var char * var_1498h @ rbp-0x1498
var char * src @ rbp-0x1490
var char * v2 @ rbp-0x1488
var char * var_1480h @ rbp-0x1480
var void * var_1478h @ rbp-0x1478
var char * var_1470h @ rbp-0x1470
var void * var_1420h @ rbp-0x1420
var char * s1 @ rbp-0x1020
var int var_18h @ rbp-0x18
arg int arg_1020h @ rbp+0x1020
arg char * dest @ rbp+0x1470
arg int argc @ rdi
arg char ** argv @ rsi
var char ** str @ rbp-0xb0
var signed int var_a4h @ rbp-0xa4
var signed int var_a0h @ rbp-0xa0
var uint32_t var_9ch @ rbp-0x9c
var int var_98h @ rbp-0x98
var int var_94h @ rbp-0x94
var int var_90h @ rbp-0x90
var int var_8ch @ rbp-0x8c
var int var_88h @ rbp-0x88
var int var_84h @ rbp-0x84
var int var_80h @ rbp-0x80
var int var_7ch @ rbp-0x7c
var int var_78h @ rbp-0x78
var int var_74h @ rbp-0x74
var int var_70h @ rbp-0x70
var int var_6ch @ rbp-0x6c
var int var_68h @ rbp-0x68
var int var_64h @ rbp-0x64
var char * var_60h @ rbp-0x60
var char * var_58h @ rbp-0x58
var char * var_50h @ rbp-0x50
var char * var_48h @ rbp-0x48
var uint32_t var_40h @ rbp-0x40
var char * s1 @ rbp-0x38
var char * s @ rbp-0x30
var char * var_28h @ rbp-0x28
var char * var_20h @ rbp-0x20
var int var_18h @ rbp-0x18
var int var_8h @ rbp-0x8
arg signed int arg1 @ rdi
arg char ** arg2 @ rsi
RUN

NAME=bashbot test (arm 32-bits)
FILE=../bins/anal/bashbot.arm.gcc.O0.elf
CMDS=<<EXPECT
s main
af
aaft
afv
EXPECT=<<RUN
var int var_0h @ sp+0x0
var int var_48h @ fp-0x48
var char * s1 @ fp-0x44
var void * var_40h @ fp-0x40
var int var_3ch @ fp-0x3c
var int var_38h @ fp-0x38
var pid_t pid @ fp-0x34
var char * v4 @ fp-0x30
var int var_2ch @ fp-0x2c
var char * src @ fp-0x28
var int var_24h @ fp-0x24
var char * var_20h @ fp-0x20
var char * s @ fp-0x1c
var char * var_18h @ fp-0x18
var int var_14h @ fp-0x14
var int var_10h @ fp-0x10
arg char ** argv @ r1
RUN

NAME=format string parse
FILE=../bins/anal/format
CMDS=<<EXPECT
aa
aaft
s main
afv
EXPECT=<<RUN
var int var_25h @ rbp-0x25
var signed int var_24h @ rbp-0x24
var uint32_t var_20h @ rbp-0x20
var int var_1ch @ rbp-0x1c
var char * var_18h @ rbp-0x18
var long int var_10h @ rbp-0x10
var char * var_8h @ rbp-0x8
RUN

NAME=local to register var type propgation
FILE=../bins/anal/l2rbin
CMDS=<<EXPECT
aa
aaft
s main
afv
EXPECT=<<RUN
var char ** var_28h @ rbp-0x28
var char ** var_20h @ rbp-0x20
var int var_14h @ rbp-0x14
var void * var_10h @ rbp-0x10
var int var_4h @ rbp-0x4
arg int argc @ rdi
arg char ** argv @ rsi
arg char ** envp @ rdx
RUN

NAME=constrained type
FILE=../bins/anal/constr_type
CMDS=<<EXPECT
e anal.types.constraint = true
aaa
s sym.single_cond
pd 1~4h
s sym.range_small
pd 1~14h
s sym.range_high
pd 1~4h
s sym.range_or
pd 1~4h
EXPECT=<<RUN
|           ; var signed int var_4h  { > 0xa} @ rbp-0x4
|           ; var signed int var_14h  { > 0x0 && <= 0x9} @ rbp-0x14
|           ; var signed int var_4h  { > 0x64 && <= 0xc7} @ rbp-0x4
|           ; var signed int var_4h  { > 0xff && <= 0x12b || > 0x14 && <= 0x31 || > 0x6f && <= 0xdd} @ rbp-0x4
RUN

NAME=mov str
FILE=../bins/anal/movstr
CMDS=<<EXPECT
aaa
s main
afv~var_4h
EXPECT=<<RUN
var char * var_4h @ esp+0x4
RUN

NAME=ret type pointer
FILE=../bins/anal/tie-test
CMDS=<<EXPECT
aaa
s sym.foo
afv~var_20h
EXPECT=<<RUN
var size_t * var_20h @ rbp-0x20
RUN
